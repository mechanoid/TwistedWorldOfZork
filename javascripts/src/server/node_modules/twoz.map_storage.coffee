redis = require('redis')
tile_generator = require('twoz.tile_generator')


class MapStorage
  twoz_id: (id) =>
    "twoz:#{id}"

  lookup: (id, cb, callback) ->
    client =  redis.createClient()
    client.on "error", (error) =>
      @onerror?()

    client.get @twoz_id(id), (err, reply) =>
      tile_rows = reply ? tile_generator.build()
      client.rpush(@twoz_id(id), row) for row in tile_rows unless reply?
      callback(tile_rows, cb)
      client.quit()

module.exports = new MapStorage()